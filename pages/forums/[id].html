<style>
  /* Add this CSS for the post view container */
  .forum_post_view_container {
    width: 60%;
    margin: 20px auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .top {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .top img {
    width: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .top h2 {
    margin-right: auto;
    color: #3498db;
  }

  .top p {
    margin-right: 10px;
    color: #95a5a6; /* Gray color for post date */
  }

  .top button {
    background-color: #3498db;
    color: #fff;
    border: none;
    border-radius: 5%;
    padding: 8px 16px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
    margin-right: 10px;
  }

  .top button:hover {
    background-color: #2980b9;
  }

  .forum_post_content p {
    color: #000;
  }

  .bottom {
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .bottom button {
    background-color: #3498db;
    color: #fff;
    border: none;
    border-radius: 5%;
    padding: 8px 16px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }

  .bottom button:hover {
    background-color: #2980b9;
  }

  .forum_post_comments {
    margin-top: 20px;
  }

  .comment {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .comment img {
    width: 30px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .comment h4 {
    margin-right: auto;
    color: #e74c3c; /* Red color for comment username */
  }

  .comment p {
    color: #000;
  }

  a {
    text-decoration: none;
    color: #3498db;
  }

  /* Add this CSS to your existing styles */
  .like-button.liked {
    background-color: #e74c3c; /* Liked color */
  }

  .like-button.liked:hover {
    background-color: #e74c3c; /* Liked color */
  }

  .dislike-button.disliked {
    background-color: #e74c3c; /* Disliked color */
  }

  .dislike-button.disliked:hover {
    background-color: #e74c3c; /* Disliked color */
  }

  .like-button,
  .dislike-button {
    display: flex;
    align-items: center;
    gap: 5px; /* Adjust spacing as needed */
  }
</style>

<input type="hidden" name="forum_id" value="<<$id>>" />
<div class="forum_post_view_container">
  <div class="top">
    <img src="" alt="" />
    <h2>Username</h2>
    <p>Post Date</p>
    <button onclick="like()" id="likeButtonID" class="like-button">
      <span id="likeCount"></span>
      <i class="fa fa-thumbs-up"></i>
    </button>
    <button onclick="dislike()" id="dislikeButtonID" class="dislike-button">
      <span id="dislikeCount"></span>
      <i class="fa fa-thumbs-down"></i>
    </button>
    <button>Report</button>
  </div>
  <div class="forum_post_content">
    <h1>Title</h1>
    <p>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Asperiores
      nesciunt quis molestiae error laudantium deserunt quia possimus quae.
      Nobis facere iusto deserunt corporis perferendis necessitatibus eos et.
      Quidem, similique itaque.
    </p>
  </div>
</div>
<script>
  const id = document.querySelector("input[name='forum_id']").value;
  const forumPostView = document.querySelector(".forum_post_view_container");
  const route = "/api/forums/";
  const title = document.querySelector(".forum_post_content h1");
  const userImage = document.querySelector(".top img");
  const username = document.querySelector(".top h2");
  const postDate = document.querySelector(".top p");
  const likeButton = document.getElementById("likeButtonID");
  const dislikeButton = document.getElementById("dislikeButtonID");
  const reportButton = document.querySelector(".top button:nth-child(3)");
  const likeCount = document.querySelector(".top p:nth-child(4)");
  const dislikeCount = document.querySelector(".top p:nth-child(5)");
  let hasLiked = false;
  let hasDisliked = false;
  async function fetchData() {
    try {
      const response = await fetch(route + id);
      const data = await response.json();

      if (data.error) {
        displayError("Error Getting Forum posts from the server");
        return;
      }

      userImage.src = data.userimageurl || "";
      console.log(data, userImage);
      title.textContent = data.title || "";
      document.getElementById("likeCount").textContent = data.likes || 0;
      document.getElementById("dislikeCount").textContent = data.dislikes || 0;
      username.innerHTML = `<a href="/user/${data.userid}">${data.username}</a>`;
      postDate.textContent = formatDate(data.date) || "";

      const hasLikedResponse = await fetch(route + "hasliked/" + id);
      const hasLikedData = await hasLikedResponse.json();
      updateLikedStatus(hasLikedData.liked);

      const hasDislikedResponse = await fetch(route + "hasdisliked/" + id);
      const hasDislikedData = await hasDislikedResponse.json();
      updateDislikedStatus(hasDislikedData.disliked);
    } catch (error) {
      console.error("Error fetching data:", error);
      displayError("Error fetching data from the server");
    }
  }

  function updateLikedStatus(liked) {
    if (liked) {
      likeButton.classList.add("liked");
      hasLiked = true;
    } else {
      likeButton.classList.remove("liked");
      hasLiked = false;
    }
  }

  function updateDislikedStatus(disliked) {
    if (disliked) {
      dislikeButton.classList.add("disliked");
      hasDisliked = true;
    } else {
      dislikeButton.classList.remove("disliked");
      hasDisliked = false;
    }
  }

  async function updateCounts() {
    try {
      const response = await fetch(route + id);
      const data = await response.json();

      if (data.error) {
        displayError("Error updating counts from the server");
        return;
      }

      document.getElementById("likeCount").textContent = data.likes || 0;
      document.getElementById("dislikeCount").textContent = data.dislikes || 0;

      const hasLikedResponse = await fetch(route + "hasliked/" + id);
      const hasLikedData = await hasLikedResponse.json();
      updateLikedStatus(hasLikedData.liked);

      const hasDislikedResponse = await fetch(route + "hasdisliked/" + id);
      const hasDislikedData = await hasDislikedResponse.json();
      updateDislikedStatus(hasDislikedData.disliked);
    } catch (error) {
      console.error("Error updating counts:", error);
      displayError("Error updating counts from the server");
    }
  }

  function like() {
    if (!hasLiked) {
      fetchAction(route + "like/" + id);
    } else {
      updateCounts();
    }
  }

  function dislike() {
    if (!hasDisliked) {
      fetchAction(route + "dislike/" + id);
    } else {
      updateCounts();
    }
  }

  function fetchAction(actionRoute) {
    fetch(actionRoute, {
      method: "POST",
    })
      .then((res) => {
        if (res.ok) {
          updateCounts();
          if (actionRoute.includes("like")) {
            likeButton.classList.add("liked");
          } else if (actionRoute.includes("dislike")) {
            dislikeButton.classList.add("disliked");
          }
        } else {
          modal(
            "",
            `You already ${
              actionRoute.includes("like") ? "liked" : "disliked"
            } this post`,
            `You can only ${
              actionRoute.includes("like") ? "like" : "dislike"
            } a post once`
          );
        }
      })
      .catch((error) => {
        console.error("Error performing action:", error);
      });
  }

  function displayError(message) {
    error(message);
  }

  function formatDate(date) {
    const options = {
      year: "numeric",
      month: "long",
      day: "numeric",
    };
    return new Date(date).toLocaleDateString("en-US", options);
  }

  fetchData();
</script>
